version: '3.7'

services:
  db:
    image: mysql:latest
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
    volumes:
      - type: bind
        source: C:\ProgramData\MySQL\MySQL Server 8.0\Data
        target: /var/lib/mysql
        consistency: consistent
        read_only: false
    user: "1000:1000"
  
  redis:
    image: redis:latest

  app:
    depends_on:
      - db
      - redis
    image: node:lts-alpine3.16
    ports:
      - 7999:8000
    command: sh -c 'cd ioblog && ls && node app.js'
    volumes:
      - ./:/ioblog

# volumes:
#   db_data:
#     driver: local
#     driver_opts:
#       type: none
#       device: C:\ProgramData\MySQL\MySQL Server 8.0\Data
#       o: bind
#       uid: "mysql"
#       gid: "mysql"

# db-data:
#   image: alpine:latest
#   command: chown -R mysql:mysql && cp -a /data/. /var/lib/mysql/
#   volumes:
#     - type: bind
#       source: C:\ProgramData\MySQL\MySQL Server 8.0\Data
#       target: /data